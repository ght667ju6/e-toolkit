
<!DOCTYPE html>
<html>
 <body>
   <style>
     body {
       margin: 0;
       background: black;
       display: flex;
       justify-content: center;
       align-items: center;
       height: 100vh;
       overflow: hidden;
       flex-direction: column;
     }

     /* --- Navigation Controls --- */
     .controls {
       position: fixed;
       bottom: 0;
       left: 0;
       right: 0;
       background: rgba(0,0,0,0.85);
       color: white;
       display: grid;
       grid-template-rows: repeat(2, auto);
       grid-gap: 7px;
       justify-content: stretch;
       align-items: center;
       padding: 10px;
       transition: transform 0.3s ease;
       transform: translateY(100%);
     }
     .controls.visible { transform: translateY(0); }

     .controls > div {
       display: flex;
       flex: 1;
       justify-content: space-around;
       align-items: center;
     }

     .controls label { font-size: 14px; margin-right: 6px; }
     .controls select, .controls input, .controls button { flex: 1; margin-right: 6px; }
   </style>

   <!-- Shadow DOM Elements -->
   <light-tube></light-tube>
   <metronome-element style="display:none"></metronome-element>
   <strobe-flash style="display:none"></strobe-flash>

   <!-- Navigation Controls -->
   <div class="controls" id="controls">
     <div>
       <label for="mode">Mode:</label>
       <select id="mode">
         <option value="light-tube">Light Tube</option>
         <option value="metronome-element">Metronome</option>
         <option value="strobe-flash">Strobe Flash</option>
       </select>

       <label for="speed">Speed:</label>
       <input type="range" id="speed" min="100" max="5000" step="100" value="2000">

       <label for="color">Color:</label>
       <input type="color" id="color" value="#ffffff">
     </div>

     <div>
       <label for="vibration">Vibration:</label>
       <input type="checkbox" id="vibration" checked>

       <label for="sound">Sound:</label>
       <input type="checkbox" id="sound" checked>

       <label for="soundMode">Sound Mode:</label>
       <select id="soundMode">
         <option value="clock">Clock Tick</option>
         <option value="wood">Wood Block</option>
         <option value="click">Click</option>
         <option value="beep">Beep</option>
         <option value="snare">Snare Tap</option>
         <option value="bell">Bell</option>
         <option value="marimba">Marimba</option>
         <option value="rim">Rim</option>
         <option value="clap">Clap</option>
         <option value="tom">Tom</option>
         <option value="hi-hat">Hi-Hat</option>
         <option value="chime">Chime</option>
         <option value="cowbell">Cowbell</option>
         <option value="kick" selected>Kick</option>
         <option value="pop">Pop</option>
       </select>

       <button id="fullscreen">â›¶ Fullscreen</button>
     </div>
   </div>

   <script>
   /* --- Global Variables --- */
   const audioCtx = new (window.AudioContext||window.webkitAudioContext)();
   let soundEnabled = true, vibrationEnabled = true, lastSpeed = "2000ms", soundMode = "kick";

   /* --- Sound Function --- */
   function playTick(){
     if(!soundEnabled) return;
     const now = audioCtx.currentTime;
     let osc;
     switch(soundMode){
       case "clock": createOsc(1000,0.3,0.1); break;
       case "wood": createOsc(200,0.4,0.2); break;
       case "click": createOsc(3000,0.2,0.05); break;
       case "beep": createOsc(800,0.25,0.3); break;
       case "snare": createNoise(0.2,0.4); break;
       case "bell": createOsc(1200,0.25,0.4); break;
       case "marimba": createOsc(400,0.3,0.3); break;
       case "rim": createOsc(250,0.25,0.15); break;
       case "clap": createNoise(0.1,0.3); break;
       case "tom": createOsc(120,0.5,0.25); break;
       case "hi-hat": createNoise(0.05,0.2); break;
       case "chime": createOsc(1000,0.3,0.4); break;
       case "cowbell": createOsc(800,0.25,0.2); break;
       case "kick": createOsc(60,0.5,0.4); break;
       case "pop": createOsc(1500,0.25,0.05); break;
     }

     function createOsc(freq,amp,dur){
       let o=audioCtx.createOscillator();
       let g=audioCtx.createGain();
       o.type="sine"; o.frequency.value=freq;
       g.gain.setValueAtTime(amp,now); g.gain.exponentialRampToValueAtTime(0.001,now+dur);
       o.connect(g).connect(audioCtx.destination); o.start(now); o.stop(now+dur);
     }

     function createNoise(duration,amp){
       let buf=audioCtx.createBuffer(1,audioCtx.sampleRate*duration,audioCtx.sampleRate);
       let data=buf.getChannelData(0);
       for(let i=0;i<data.length;i++){ data[i]=(Math.random()*2-1)*Math.exp(-i/1000); }
       let src=audioCtx.createBufferSource(); src.buffer=buf;
       let g=audioCtx.createGain();
       g.gain.setValueAtTime(amp,now); g.gain.exponentialRampToValueAtTime(0.001,now+duration);
       src.connect(g).connect(audioCtx.destination); src.start(now); src.stop(now+duration);
     }
   }

   /* --- Web Components --- */
   class LightTube extends HTMLElement{
     constructor(){
       super();
       const shadow=this.attachShadow({mode:"open"});
       const ball=document.createElement("div"); ball.classList.add("light-ball");
       const style=document.createElement("style");
       style.textContent=`
         :host { --tube-color:white; --tube-speed:2000ms; }
         .light-ball{width:50px;height:50px;border-radius:50%;
           background:var(--tube-color); box-shadow:0 0 40px 15px var(--tube-color);
           position:absolute; top:50%; transform:translateY(-50%);
           animation: moveHorizontally var(--tube-speed) linear infinite alternate;
         }
         @keyframes moveHorizontally { from{left:0;} to{left:calc(100vw - 50px);} }
       `;
       shadow.appendChild(style); shadow.appendChild(ball);
       ball.addEventListener("animationiteration",()=>{
         if(vibrationEnabled) navigator.vibrate(Math.max(20, Math.min(200, parseInt(lastSpeed)/10)));
         playTick();
       });
     }
   }
   customElements.define("light-tube",LightTube);

   class MetronomeElement extends HTMLElement{
     constructor(){
       super();
       const shadow=this.attachShadow({mode:"open"});
       const wrapper=document.createElement("section"); wrapper.classList.add("metronome");
       const pendulum=document.createElement("section"); pendulum.classList.add("pendulum");
       wrapper.appendChild(pendulum);
       const style=document.createElement("style");
       style.textContent=`
         :host { --pendulum-color:white; --pendulum-speed:2000ms; }
         .metronome{position:relative;width:6vw;height:100vh;display:flex;justify-content:center;}
         .pendulum{width:6vw;height:100vh;
           box-shadow:0 0 32px 2px var(--pendulum-color);
           background-color:var(--pendulum-color);
           transform-origin: top center;
           animation: movePendulum var(--pendulum-speed) ease-in-out alternate infinite;
         }
         @keyframes movePendulum{0%,100%{transform:rotate(80deg);}50%{transform:rotate(-80deg);}}
       `;
       shadow.appendChild(style); shadow.appendChild(wrapper);
       pendulum.addEventListener("animationiteration",()=>{
         if(vibrationEnabled) navigator.vibrate(Math.max(20, Math.min(200, parseInt(lastSpeed)/10)));
         playTick();
       });
     }
   }
   customElements.define("metronome-element",MetronomeElement);

   class StrobeFlash extends HTMLElement{
     constructor(){
       super();
       const shadow=this.attachShadow({mode:"open"});
       const root=document.createElement("section"); root.classList.add("root-container");
       const strobe=document.createElement("section"); strobe.classList.add("strobe-flash-light");
       for(let i=0;i<2;i++){
         const row=document.createElement("div"); row.classList.add("row");
         for(let j=0;j<2;j++){
           const light=document.createElement("div"); light.classList.add("light"); row.appendChild(light);
         }
         strobe.appendChild(row);
       }
       root.appendChild(strobe); shadow.appendChild(root);
       const style=document.createElement("style");
       style.textContent=`
         :host { --light-color:white; --strobe-speed:250ms; }
         .root-container{width:100%;height:100%;display:flex;justify-content:center;align-items:center;}
         .strobe-flash-light{width:80%;height:80%;display:flex;flex-direction:column;align-items:center;}
         .row{display:flex;}
         .light{width:13vw;height:13vw;border-radius:50%;
           background-color:var(--light-color);
           box-shadow:0 0 40px 15px var(--light-color);
           animation: lightAnimation var(--strobe-speed) ease-in-out alternate infinite;
         }
         .row:last-child{margin-top:90px;}
         .light:last-child{margin-left:90px;}
         @keyframes lightAnimation{11%,100%{background-color:black; box-shadow:none;}0%,10%{background-color:var(--light-color); box-shadow:0 0 40px 15px var(--light-color);}}
       `;
       shadow.appendChild(style);
       shadow.querySelectorAll(".light").forEach(light=>{
         light.addEventListener("animationiteration",()=>{
           if(vibrationEnabled) navigator.vibrate(Math.max(20, Math.min(200, parseInt(lastSpeed)/10)));
           playTick();
         });
       });
     }
   }
   customElements.define("strobe-flash",StrobeFlash);

   /* --- Controls Logic --- */
   const controls = document.getElementById("controls");
   const modeSelect = document.getElementById("mode");
   const speedInput = document.getElementById("speed");
   const colorInput = document.getElementById("color");
   const vibrationToggle = document.getElementById("vibration");
   const soundToggle = document.getElementById("sound");
   const soundModeSelect = document.getElementById("soundMode");
   const fullscreenBtn = document.getElementById("fullscreen");

   const components = {
     "light-tube": document.querySelector("light-tube"),
     "metronome-element": document.querySelector("metronome-element"),
     "strobe-flash": document.querySelector("strobe-flash")
   };
   let current="light-tube";
   lastSpeed=speedInput.value+"ms";

   function applySettings(el){
     if(!el) return;
     if(el.tagName==="LIGHT-TUBE"){ el.style.setProperty("--tube-color", colorInput.value); el.style.setProperty("--tube-speed", speedInput.value+"ms"); }
     if(el.tagName==="METRONOME-ELEMENT"){ el.style.setProperty("--pendulum-color", colorInput.value); el.style.setProperty("--pendulum-speed", speedInput.value+"ms"); }
     if(el.tagName==="STROBE-FLASH"){ el.style.setProperty("--light-color", colorInput.value); el.style.setProperty("--strobe-speed", speedInput.value+"ms"); }
   }

   /* --- Event Listeners --- */
   document.body.addEventListener("click",(e)=>{ if(!e.target.closest(".controls")) controls.classList.toggle("visible"); });
   modeSelect.addEventListener("change",()=>{ current=modeSelect.value; Object.keys(components).forEach(k=>components[k].style.display=k===current?"block":"none"); applySettings(components[current]); });
   speedInput.addEventListener("input",()=>{ lastSpeed=speedInput.value+"ms"; applySettings(components[current]); });
   colorInput.addEventListener("input",()=>{ applySettings(components[current]); });
   vibrationToggle.addEventListener("change",()=>{ vibrationEnabled=vibrationToggle.checked; });
   soundToggle.addEventListener("change",()=>{ soundEnabled=soundToggle.checked; });
   soundModeSelect.addEventListener("change",()=>{ soundMode=soundModeSelect.value; });
   fullscreenBtn.addEventListener("click",()=>{
     if(!document.fullscreenElement){ document.documentElement.requestFullscreen(); fullscreenBtn.textContent="â›¶ Exit"; }else{ document.exitFullscreen(); fullscreenBtn.textContent="â›¶ Fullscreen"; }
   });
   </script>
 </body>
</html>
